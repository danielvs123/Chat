<!doctype html>
<html>
<head>
    <title>Socket.IO chat</title>
    <style>
        body{
            margin: 0;
            padding: 0;
        }
        .friend_div{
            width: 100%;height: 60px;border-bottom: 1px solid rgba(0,0,0,0.5);position: relative;
        }
        .friend_avatar{
            position:absolute;width: 50px;left: 10px;top: 5px;
        }
        .friend_title{
            position:absolute;left: 70px;top: 5px;font-size: 18px
        }
        .friend_text{
            position:absolute;left: 70px;bottom: 5px;font-size: 16px;color: gray;font-weight: lighter
        }
        #robot_outer{
            width: 100px;height: 100px;position: fixed;right: 0;border:1px solid gray;
        }
        .robot{
            width: 100%;height: 50px;line-height: 50px;text-align: center;
        }
    </style>
    <style type="text/css">
        .sender{
            clear:both;
        }
        .sender div:nth-of-type(1){
            float: left;
        }
        .sender div:nth-of-type(2){
            background-color: aquamarine;
            float: left;
            margin: 0 20px 10px 15px;
            padding: 10px 10px 10px 0px;
            border-radius:7px;
        }

        .receiver div:first-child img,
        .sender div:first-child img{
            width:50px;
            height: 50px;
        }

        .receiver{
            clear:both;
        }
        .receiver div:nth-child(1){
            float: right;
        }
        .receiver div:nth-of-type(2){
            float:right;
            background-color: gold;
            margin: 0 10px 10px 20px;
            padding: 10px 0px 10px 10px;
            border-radius:7px;
        }

        .left_triangle{
            height:0px;
            width:0px;
            border-width:8px;
            border-style:solid;
            border-color:transparent aquamarine transparent transparent;
            position: relative;
            left:-16px;
            top:3px;
        }

        .right_triangle{
            height:0px;
            width:0px;
            border-width:8px;
            border-style:solid;
            border-color:transparent transparent transparent gold;
            position: relative;
            right:-16px;
            top:3px;
        }
    </style>
</head>
<body>
<div id="robot_outer">
    <div class="robot">userIdDemo1</div>
    <div class="robot">userIdDemo2</div>
</div>
<div style="width: 250px;height: 100vh;border-right: 1px solid rgba(0,0,0,0.5);position: fixed;top: 0;" id="friend">

</div>
<div style="width: 450px;height: 100vh;border-right: 1px solid rgba(0,0,0,0.5);position: fixed;top: 0;right: 0" id="chat">
    <div class="sender">
        <div>
            <img src="chatTemplateExample2_files/cat.jpg">
        </div>
        <div>
            <div class="left_triangle"></div>
            <span> hello, man! </span>
        </div>
    </div>
    <!-- Right -->
    <div class="receiver">
        <div>
            <img src="chatTemplateExample2_files/cat.jpg">
        </div>
        <div>
            <div class="right_triangle"></div>
            <span> hello world </span>
        </div>
    </div>
</div>
<script src="/socket.io/socket.io.js"></script>
<script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script type="application/javascript">
    $(".robot").click(function () {
        $('#robot_outer').hide();
        uid =  this.innerText;
        connect();
        getFriendList();
    });
    var uid = "userIdDemo1";
    function connect() {
        var socket = io();
        socket.emit("getPersonalInfo",{
            id:uid
        });
        var opposite = (uid === "userIdDemo1")?"userIdDemo2":"userIdDemo1";
        socket.emit("privateChat",opposite,"你好，我是"+uid);
        socket.on("mailBox"+uid,function (msg) {
            console.log(msg);
        });
    }

    var friend = document.getElementById("friend"),
        personalInfo = {},
        friendsInfo = {};

    function getFriendList() {
        //获取好友列表;
        $.ajax({
            type: 'POST',
            url: "getFriendList",
            data: {
                id:uid,
                accessToken:3333
            },
            success: function (data) {
                data = JSON.parse(data);
                if (data.status === 0){
                    for (var i = 0;i<data.length;i++){
                        //创建页面
                        var div = document.createElement("div"),
                            img = document.createElement("img"),
                            span_title = document.createElement("span"),
                            span_text = document.createElement("span");
                        img.src = data.data[i].avatar;
                        span_title.innerText = data.data[i].name;
                        span_text.innerText = "测试一下";
                        div.className = "friend_div";
                        img.className = "friend_avatar";
                        span_text.className = "friend_text";
                        span_title.className = "friend_title";
                        friend.appendChild(div);
                        div.appendChild(img);
                        div.appendChild(span_title);
                        div.appendChild(span_text);

                        //插入好友列表
                        friendsInfo[data.data[i].id] = {
                            name:data.data[i].name,
                            avatar:data.data[i].avatar
                        };
                    }
                }
            }
        });
        $.ajax({
            type: 'POST',
            url: "getPrivateInfo",
            data: {
                id:uid,
                accessToken:3333
            },
            success: function (data) {
                data = JSON.parse(data);
                if (data.status === 0){
                    personalInfo = {
                        name:data.data.name,
                        avatar:data.data.avatar
                    }
                }
            }
        });
    }

    function sender() {
        var sender = document.createElement("div");
        div.className = "sender";
        var avatar = document.createElement("div"),
            avatarImg = document.createElement("img");

    }
</script>
</body>
</html>