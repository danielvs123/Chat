<!doctype html>
<html>
<head>
    <title>Socket.IO chat</title>
    <style>
        body{
            margin: 0;
            padding: 0;
        }
        .friend_div{
            width: 100%;height: 60px;border-bottom: 1px solid rgba(0,0,0,0.5);position: relative;
        }
        .friend_avatar{
            position:absolute;width: 50px;left: 10px;top: 5px;
        }
        .friend_title{
            position:absolute;left: 70px;top: 5px;font-size: 18px
        }
        .friend_text{
            position:absolute;left: 70px;bottom: 5px;font-size: 16px;color: gray;font-weight: lighter
        }
        #robot_outer{
            width: 100px;height: 100px;position: fixed;right: 0;border:1px solid gray;
        }
        .robot{
            width: 100%;height: 50px;line-height: 50px;text-align: center;
        }
    </style>
</head>
<body>
<div id="robot_outer">
    <div class="robot">userIdDemo1</div>
    <div class="robot">userIdDemo2</div>
</div>
<div style="width: 250px;height: 100vh;border-right: 1px solid rgba(0,0,0,0.5);position: fixed;top: 0;" id="friend">
</div>
<script src="/socket.io/socket.io.js"></script>
<script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script type="application/javascript">
    $(".robot").click(function () {
        $('#robot_outer').hide();
        uid =  this.innerText;
        connect();
        getFriendList();
    });
    var uid = "userIdDemo1";
    function connect() {
        var socket = io();
        socket.emit("getPersonalInfo",{
            id:uid
        });
        var opposite = (uid === "userIdDemo1")?"userIdDemo2":"userIdDemo1";
        socket.emit("privateChat",opposite,"你好，我是"+uid);
        socket.on("mailBox"+uid,function (msg) {
            console.log(msg);
        });
    }

    var friend = document.getElementById("friend");

    function getFriendList() {
        //获取好友列表;
        $.ajax({
            type: 'POST',
            url: "getFriendList",
            data: {
                id:uid,
                accessToken:3333
            },
            success: function (data) {
                data = JSON.parse(data);
                if (data.status === 0){
                    for (var i = 0;i<data.length;i++){
                        var div = document.createElement("div"),
                            img = document.createElement("img"),
                            span_title = document.createElement("span"),
                            span_text = document.createElement("span");
                        console.log(data.data[i].avatar);
                        img.src = data.data[i].avatar;
                        span_title.innerText = data.data[i].name;
                        span_text.innerText = "测试一下";
                        div.className = "friend_div";
                        img.className = "friend_avatar";
                        span_text.className = "friend_text";
                        span_title.className = "friend_title";
                        friend.appendChild(div);
                        div.appendChild(img);
                        div.appendChild(span_title);
                        div.appendChild(span_text);
                    }
                }
                console.log(data);
            }
        });
    }
</script>
</body>
</html>