<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script type="application/javascript">
    ;(function ( db, undefined ){
        var version = "1.0.0",
            status = false,
            dbName = "",
            database = undefined,
            request = undefined,
            objectStore = undefined;

        var waitList = [];
        db.init = function (name) {
            dbName = name;
            if (!window.indexedDB){
                alert("indexedDB is not supported");
            }else{
                request = indexedDB.open(name,1);
                request.onerror = function () {
                    alert("indexedDB is not allowed");
                };
                request.onsuccess = function (event) {
                    status = true;
                    database = event.target.result;
                };
                request.onupgradeneeded = function (event) {
                    database = event.target.result;
                    objectStore = database.createObjectStore("chatData", {autoIncrement:true});
                    objectStore.add({info:"123",id:"321"});
                    db.clearWaitList();
                }
            }
        };
        db.clearWaitList = function () {
            for (var i = 0;i<waitList.length;i++){
                objectStore.add(waitList[i]);
            }
        };
        db.insert = function (data) {
            if (status){
                var transaction = database.transaction(["toDoList"], "readwrite");
                objectStore.add(data);
            }else{
                waitList.push(data);
            }
        }
    }( window.db = window.db || {} ));
    db.init("daniel");
    db.insert({info:"333",id:"321"})
    setTimeout(function () {
        db.insert({info:"333333",id:"321"})
    },3000);
</script>
</body>
</html>